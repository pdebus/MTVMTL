\chapter{Derivative Computations}
\label{ap:derivative}

The following computation are based on the notation used in \cite{Magnus}. At the core of 
the computation is the following relation for the differential $dF$ of a function $f$, considered 
as map between two matrix spaces.

\begin{equation}
\mathop{d}\operatorname{vec} F(X) =\operatorname{vec}\mathop{dF}(X),
\end{equation}
where $\operatorname{vec}$ denotes the vectorization operator $\operatorname{vec}:\mathbb{R}^{n\times p} \to \mathbb{R}^{np}$, which forms a vector from a matrix by column-wise stacking. In the next sections, the computation will be demonstrated for the case
of the special orthogonal group. The computations for the other manifolds work analogously.


\section{Vectorization-Kronecker-product identities}
Another important tool for the computation of derivatives are the following identities
for the vectorization operator and the Kronecker product $\otimes$.

\begin{equation}
\operatorname{vec}(ABC)=(C^T \otimes A)\operatorname{vec} B
\end{equation}
If one of the matrices in the above product is replaced by the identity matrix $\mathbbm{1}$,
an additional set of three identities can be obtained.
\begin{align}
\operatorname{vec}(AB)	&=(B^T \otimes A)\operatorname{vec} A\\
						&=(B^T \otimes A)\operatorname{vec} \mathbbm{1}\\
						&=(\mathbbm{1} \otimes A)\operatorname{vec} B\\
\end{align}

\section{Squared distance function on the special orthogonal group $SO(n)$}
The first derivative $\frac{\partial d^2(X,Y)}{\partial X} = -2X\log(X^TY) =: T_4$ can be decomposed as follows
\begin{align}
T_1 &= X^TY \\
T_2 &= -2X \\	
T_3 &= \log T_1\\  
T_4 &= T_2 T_3
\end{align}

The derivative of the first line with respect to $X$ is given by
\begin{align}
\mathop{d}T_1(X)&=\mathop{d}X^TY\\
\mathop{d}\operatorname{vec}T_1(X)&= \operatorname{vec}\mathop{d}X^TY\\
			&=(Y^T\otimes\mathbbm{1}_n)  \operatorname{vec}\mathop{d}X^T\\
			&=\underbrace{(Y^T\otimes\mathbbm{1}_n)K_{nn}}_{\mathop{dT}_1(X)}  \operatorname{vec}\mathop{dX}.
\end{align}

Hence, 
\begin{equation}
\frac{\partial T_1}{\partial X} = (Y^T\otimes\mathbbm{1_n})K_{nn}
\end{equation}
where $K_{nn}$ denotes the so-called commutator matrix transforming the vectorization
of a matrix to the vectorization of the transpose of the matrix. More details
on the properties of the permutation matrix can be found in \cite{Magnus}.\\

Now for the second part one has
\begin{align}
\mathop{d}T_2(X)&=-2\mathop{dX}\\
\mathop{d}\operatorname{vec}T_2(X)&= \operatorname{vec}-2\mathop{dX} = \underbrace{-2\mathbbm{1}_{n^2}}_{\mathop{dT}_2(X)}
\end{align}
leading to the Kronecker representation
\begin{equation}
\frac{\partial T_2}{\partial X} = -2\mathbbm{1}_{n^2}.
\end{equation}

The third part yields
\begin{equation}
\frac{\partial T_3}{\partial X} = \frac{\partial T_3}{\partial T_1}\frac{\partial T_1}{\partial T_X}=
\mathop{d}\log(Y^T\otimes\mathbbm{1_n})K_{nn}.
\end{equation}

Finally, only the last part is need to put everything together. From 
\begin{align}
\mathop{d}T_3(X)&=\mathop{d}T_2(X)T_3(X)+T_2(X)\mathop{d}T_3(X)\\
\mathop{d}\operatorname{vec}T_2(X)&=\operatorname{vec}\mathop{d}T_2T_3
\operatorname{vec}T_2\mathop{d}T_3\\
&=(T_3^T\otimes\mathbbm{1_n})\operatorname{vec}\mathop{d}T_2 + 
(\mathbbm{1_n}\otimes T_2)\operatorname{vec}\mathop{d}T_3
\end{align}
and the previous parts, one arrives at 
\begin{equation}
\frac{\partial T_4}{\partial X} = (T_3^T\otimes\mathbbm{1_n})\frac{\partial T_2}{\partial X} + 
(\mathbbm{1_n}\otimes T_2)\frac{\partial T_3}{\partial X}.
\end{equation}
Substitution of the $T_i$ leads to the final expression presented in \ref{eq:son_xx_der}.










